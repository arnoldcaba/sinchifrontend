(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22d808"],{f888:function(o,e,t){"use strict";t.r(e);var r=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("v-container",{attrs:{fluid:""}},[t("v-card",{attrs:{flat:"",tile:""}},[t("v-card-text",[t("v-data-table",{attrs:{headers:o.headers,items:o.equipo,"items-per-page":5},scopedSlots:o._u([{key:"item.persona",fn:function(e){var r=e.item;return[t("v-autocomplete",{attrs:{items:o.arrPersonal,"item-value":"codigo","item-text":"nombrecompleto",readonly:o.readonly,"return-object":!0},model:{value:r.persona,callback:function(e){o.$set(r,"persona",e)},expression:"item.persona"}})]}},{key:"item.rol",fn:function(e){var r=e.item;return[t("v-autocomplete",{attrs:{items:o.roles,"item-value":"codigo","item-text":"descripcion",readonly:o.readonly,"return-object":!0},model:{value:r.rol,callback:function(e){o.$set(r,"rol",e)},expression:"item.rol"}})]}},{key:"item.dedicacion",fn:function(e){var r=e.item;return[t("v-text-field",{attrs:{type:"number",readonly:o.readonly,min:"0",rules:[o.rules.maxHorSemanal]},model:{value:r.dedicacion,callback:function(e){o.$set(r,"dedicacion",e)},expression:"item.dedicacion"}})]}},{key:"item.vercompromiso",fn:function(e){var r=e.item;return[t("v-icon",{directives:[{name:"show",rawName:"v-show",value:0!=r.codigoreal,expression:"item.codigoreal != 0"}],staticClass:"mr-5",attrs:{small:"",color:"primary",disabled:o.loading,loading:o.loading},on:{click:function(e){o.dialogcompromisos=!0,o.nombreintegrante=r.nombrecompleto,o.codigointegrante=r.persona,o.traerCompromisos(o.proyecto,r.persona)}}},[o._v("\n                        list_alt\n                    ")])]}},{key:"item.action",fn:function(e){var r=e.item;return[t("v-icon",{directives:[{name:"show",rawName:"v-show",value:!o.readonly&&0!=r.codigoreal,expression:"!readonly && item.codigoreal != 0"}],staticClass:"mr-5",attrs:{small:"",color:"primary",disabled:o.loading,loading:o.loading},on:{click:function(e){o.dialog_del=!0,o.itemactual=r}}},[o._v("\n                        delete\n                    ")])]}}])})],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:!o.readonly,expression:"!readonly"}],attrs:{color:"primary",text:""},on:{click:o.saveitem}},[o._v("Guardar equipo")])],1)],1),t("v-dialog",{attrs:{width:"550"},model:{value:o.dialog_del,callback:function(e){o.dialog_del=e},expression:"dialog_del"}},[t("v-card",[t("v-card-title",[t("span",{staticClass:"headline red--text"},[o._v("Eliminar Integrante")])]),t("v-card-text",[o._v("\t\t\t\t\t\n                ¿Esta seguro de eliminar el Integrante seleccionado?.\t\t\t\t\t\n            ")]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",dark:"",text:""},on:{click:function(e){o.dialog_del=!1}}},[o._v("Cancelar")]),t("v-btn",{attrs:{color:"red",text:""},on:{click:o.deleteItem}},[o._v("Eliminar")])],1)],1)],1),t("v-dialog",{attrs:{"max-width":"800",persistent:""},model:{value:o.dialogcompromisos,callback:function(e){o.dialogcompromisos=e},expression:"dialogcompromisos"}},[t("v-card",[t("v-card-text",[t("v-row",[t("v-col",{attrs:{sm12:""}},[t("v-card",{attrs:{flat:"",tile:"","min-height":"300"}},[t("v-card-text",[t("v-data-table",{attrs:{headers:o.headerscompromisos,items:o.compromisos,"items-per-page":5},scopedSlots:o._u([{key:"item.descripcion",fn:function(e){var r=e.item;return[t("v-text-field",{attrs:{readonly:o.readonly},model:{value:r.descripcion,callback:function(e){o.$set(r,"descripcion",e)},expression:"item.descripcion"}})]}},{key:"item.action",fn:function(e){var r=e.item;return[t("v-icon",{directives:[{name:"show",rawName:"v-show",value:!o.readonly&&0!=r.codigoreal,expression:"!readonly && item.codigoreal != 0"}],staticClass:"mr-5",attrs:{small:"",color:"primary",disabled:o.loading,loading:o.loading},on:{click:function(e){o.dialogcompromiso_del=!0,o.itemcompromisoactual=r}}},[o._v("\n                                            delete\n                                        ")])]}}])})],1)],1)],1)],1)],1),t("v-card-actions",[t("div",{staticStyle:{width:"100%","text-align":"right"}},[t("v-btn",{directives:[{name:"show",rawName:"v-show",value:!o.readonly,expression:"!readonly"}],attrs:{color:"primary",dark:"",text:""},on:{click:o.saveitemCompromiso}},[o._v("Actualizar")]),t("v-btn",{attrs:{color:"primary",dark:"",text:""},on:{click:function(e){o.dialogcompromisos=!1}}},[o._v("Cancelar")])],1)])],1)],1),t("v-dialog",{attrs:{width:"550"},model:{value:o.dialogcompromiso_del,callback:function(e){o.dialogcompromiso_del=e},expression:"dialogcompromiso_del"}},[t("v-card",[t("v-card-title",[t("span",{staticClass:"headline red--text"},[o._v("Eliminar Compromiso")])]),t("v-card-text",[o._v("\t\t\t\t\t\n                ¿Esta seguro de eliminar el Compromiso seleccionado?.\t\t\t\t\t\n            ")]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",dark:"",text:""},on:{click:function(e){o.dialogcompromiso_del=!1}}},[o._v("Cancelar")]),t("v-btn",{attrs:{color:"red",text:""},on:{click:function(e){return o.deleteCompromiso(o.itemcompromisoactual.personal)}}},[o._v("Eliminar")])],1)],1)],1)],1)},i=[],a=t("a1ab"),n=t("bc3a"),c=t.n(n),s=t("d89f"),l={getData:function(){return new Promise((function(o,e){c()({method:"POST",url:s["b"].apiUrl+"/ProyectosEquipoComp",dataType:"json"}).then((function(e){o(e)})).catch((function(e){o(e)}))}))},guardarData:function(o){return new Promise((function(e,t){c()({method:"POST",url:s["b"].apiUrl+"/addupdProyectoEquipoComp",dataType:"json",data:{data:o}}).then((function(o){e(o)})).catch((function(o){e(o)}))}))},DelData:function(o,e,t){return new Promise((function(r,i){c()({method:"POST",url:s["b"].apiUrl+"/delProyectoEquipoComp",dataType:"json",data:{proyecto:o,personal:e,codigo:t}}).then((function(o){r(o)})).catch((function(o){r(o)}))}))},BuscarXProyectoPersonal:function(o,e){return new Promise((function(t,r){c()({method:"POST",url:s["b"].apiUrl+"/ProyectosEquipoCompXProyecto",dataType:"json",data:{proyecto:o,personal:e}}).then((function(o){t(o)})).catch((function(o){t(o)}))}))}},d=l,m=t("b14f"),p=t("699c");function u(o){return u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"===typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},u(o)}var g={name:"Equipo",props:["proyecto","readonly","convenioproyecto","nombreproyecto","codigocoordinador"],data:function(){return{loading:!1,dialog_del:!1,itemactual:"",dialogcompromisos:!1,compromisos:[],arrPersonal:[],itemcompromisoactual:"",dialogcompromiso_del:!1,codigointegrante:0,nombreintegrante:"",roles:[],equipo:[{codigo:0,rol:"",persona:0,dedicacion:0}],headers:[{text:"Integrantes",value:"persona",sortable:!1,align:"left",width:"40%",class:"subtitle-1 font-weight-bold black--text"},{text:"Rol",align:"left",sortable:!1,value:"rol",width:"40%",class:"subtitle-1 font-weight-bold black--text"},{text:"Dedicación (Horas Semanales)",align:"left",sortable:!1,value:"dedicacion",width:"10%",class:"subtitle-1 font-weight-bold black--text"},{text:"Compromisos",value:"vercompromiso",sortable:!1,align:"left",width:"5%",class:"subtitle-1 font-weight-bold black--text"},{text:"Acción",value:"action",sortable:!1,align:"left",width:"5%",class:"subtitle-1 font-weight-bold black--text"}],headerscompromisos:[{text:"Descripción",align:"left",sortable:!1,value:"descripcion",class:"subtitle-1 font-weight-bold black--text"},{text:"Acción",value:"action",sortable:!1,align:"left",class:"subtitle-1 font-weight-bold black--text"}],rules:{maxPorcentaje:function(o){return o<100||"El % de Participación no puede superar el 100%"},maxHorSemanal:function(o){return o<40||"Las Horas Semanales del Integrante no puede ser superior a 40"}}}},methods:{showMessage:function(o,e,t,r){this.$root.$emit("showSnack",{snack:o,time:e,color:t,text:r})},envioNotificaciones:function(o,e,t){this.$emit("envioNotificaciones",{mensajenotificacion:o,asuntocorreo:e,mensajecorreo:t})},EquipoVacio:function(){var o=0;for(this.equipo=[],o;o<30;o++)this.equipo.push({codigo:o+1,proyecto:"",descripcion:"",codigoreal:0})},EquipoCompVacio:function(){var o=0;for(this.compromisos=[],o;o<20;o++)this.compromisos.push({codigo:o+1,proyecto:this.proyecto,descripcion:"",codigoreal:0,personal:this.codigointegrante})},traePersonal:function(){var o=this;this.loading=!0,m["a"].getData().then((function(e){e.request&&e.data?o.arrPersonal=e.data.data:o.arrPersonal=[],o.loading=!1})).catch((function(e){o.arrPersonal=[],o.loading=!1}))},traerequipo:function(o){var e=this;this.loading=!0,a["a"].BuscarXProyecto(o).then((function(o){if(o.request)if(o.data){e.equipo=o.data.data;for(var t=e.equipo.length,r=t;r<15;r++)e.equipo.push({proyecto:"",persona:"0",rol:"",dedicacion:0,codigoreal:0})}else e.equipo=[],e.EquipoVacio();else e.equipo=[],e.EquipoVacio();e.loading=!1})).catch((function(o){e.equipo=[],e.EquipoVacio(),e.loading=!1}))},traerRoles:function(){var o=this;p["a"].getData().then((function(e){e.request&&e.data?o.roles=e.data.data:o.roles=[]})).catch((function(e){o.roles=[]}))},traerCompromisos:function(o,e){var t=this;d.BuscarXProyectoPersonal(o,e).then((function(o){if(o.request)if(o.data){t.compromisos=o.data.data;for(var e=t.compromisos.length,r=e;r<20;r++)t.compromisos.push({proyecto:t.proyecto,personal:t.codigointegrante,descripcion:"",codigoreal:0})}else t.compromisos=[],t.EquipoCompVacio();else t.compromisos=[],t.EquipoCompVacio();t.loading=!1})).catch((function(o){t.compromisos=[],t.EquipoCompVacio()}))},deleteItem:function(){var o=this;this.loading=!0,a["a"].DelData(o.proyecto,o.itemactual.persona).then((function(e){if(e.statusText){o.showMessage(!0,3e3,"success","Se eliminó el Integrante con éxito"),o.del_item="",o.traerequipo(o.proyecto),o.dialog_del=!1,o.agregaBitacora("ELIMINACION","SE ELIMINÓ EL INTEGRANTE :"+o.itemactual.nombrecompleto+". QUE PERTENECE AL PROYECTO CON # DE CONVENIO: "+o.convenioproyecto+" Y NOMBRE: "+o.nombreproyecto);var t="Cordial Saludo,<br><br> Se eliminó el Integrante : '"+o.itemactual.nombrecompleto+"' del Proyecto con # de Convenio "+o.convenioproyecto+", Nombre: "+o.nombreproyecto+"<br><br>Agradeciendo su atención,<br><br> <b>SINCHI</b><br><br> <i>Este es un servicio de notificaciones generado automáticamente por medio de correo electrónico, no lo responda.</i> <br>",r="Se eliminó el Integrante : '"+o.itemactual.nombrecompleto+"' del Proyecto con # de Convenio "+o.convenioproyecto+", Nombre: "+o.nombreproyecto;o.envioNotificaciones(r,"Eliminación de Integrante del Proyecto",t)}else o.showMessage(!0,3e3,"error",e.response.data.message);o.del_item="",o.loading=!1})).catch((function(e){o.showMessage(!0,3e3,"error",e),o.loading=!1}))},deleteCompromiso:function(o){var e=this;this.loading=!0,d.DelData(e.proyecto,o,e.itemcompromisoactual.codigo).then((function(t){if(t.statusText){e.showMessage(!0,3e3,"success","Se eliminó el Compromiso con éxito"),e.traerCompromisos(e.proyecto,o),e.dialogcompromiso_del=!1,e.agregaBitacora("ELIMINACION","SE ELIMINÓ EL COMPROMISO :"+e.itemcompromisoactual.descripcion+" DEL INTEGRANTE: "+e.nombreintegrante+". QUE PERTENECE AL PROYECTO CON # DE CONVENIO: "+e.convenioproyecto+" Y NOMBRE: "+e.nombreproyecto);var r="Cordial Saludo,<br><br> Se eliminó el Compromiso: '"+e.itemcompromisoactual.descripcion+"' del Integrante : '"+e.nombreintegrante+"' del Proyecto con # de Convenio "+e.convenioproyecto+", Nombre: "+e.nombreproyecto+"<br><br>Agradeciendo su atención,<br><br> <b>SINCHI</b><br><br> <i>Este es un servicio de notificaciones generado automáticamente por medio de correo electrónico, no lo responda.</i> <br>",i="Se eliminó el Compromiso: '"+e.itemcompromisoactual.descripcion+"' del Integrante : '"+e.nombreintegrante+"' del Proyecto con # de Convenio "+e.convenioproyecto+", Nombre: "+e.nombreproyecto;e.envioNotificaciones(i,"Eliminación de Compromiso de Integrante del Proyecto",r)}else e.showMessage(!0,3e3,"error",t.response.data.message)})).catch((function(o){e.showMessage(!0,3e3,"error",o)}))},saveitem:function(){var o=this.equipo.length,e=[];this.loading=!0;for(var t=0,r=0;r<o;r++){var i="",n="",c="";if("object"==u(this.equipo[r].persona)?(i=this.equipo[r].persona.codigo,n=this.equipo[r].persona.nombrecompleto):(i=this.equipo[r].persona,n=this.equipo[r].nombrecompleto),"object"==u(this.equipo[r].rol)?(c=this.equipo[r].rol.codigo,this.equipo[r].rol.descripcion):(c=this.equipo[r].rol,this.equipo[r].rolnombre),""!=i&&"0"!=i&&void 0!=i){if(""==c||"0"==c||void 0==i)return this.showMessage(!0,3e3,"error","El Integrante "+n+" no tiene Rol asignado."),void(this.loading=!1);if("0"==this.equipo[r].dedicacion)return this.showMessage(!0,3e3,"error","El Integrante "+n+" no tiene Tiempo de Dedicación."),void(this.loading=!1);if(t+=parseFloat(this.equipo[r].porcentaje),e.length>0){for(var s=0;s<e.length;s++)if(i==e[s].persona){var l=r+1;return this.showMessage(!0,3e3,"error","El Integrante "+n+" del item "+l+" ya se encuentra en el item "+e[s].numero),void(this.loading=!1)}e.push({numero:r+1,persona:i,rol:c,dedicacion:this.equipo[r].dedicacion,porcentaje:this.equipo[r].porcentaje,titular:this.equipo[r].titular,proyecto:this.proyecto})}else e.push({numero:r+1,persona:i,rol:c,dedicacion:this.equipo[r].dedicacion,porcentaje:this.equipo[r].porcentaje,titular:this.equipo[r].titular,proyecto:this.proyecto})}}if(t>100)return this.showMessage(!0,3e3,"error","El total de % de participación de todos los integrantes no puede superar el 100%"),void(this.loading=!1);var d=this;a["a"].guardarData(e).then((function(o){if(o.response){var e=o.response.data.message;d.showMessage(!0,3e3,"error",e)}else if(o.statusText){d.showMessage(!0,3e3,"success","Se Actualizarón/Agregarón Integrantes al Proyecto con éxito"),d.traerequipo(d.proyecto),d.agregaBitacora("ACTUALIZACION/CREACION","SE ACTUALIZARON/AGREGARON INTEGRANTES AL PROYECTO CON # DE CONVENIO: "+d.convenioproyecto+" Y NOMBRE: "+d.nombreproyecto);var t="Cordial Saludo,<br><br> Se Actualizaron/Crearon Integrantes para el Proyecto con # de Convenio "+d.convenioproyecto+", Nombre: "+d.nombreproyecto+"<br><br>Agradeciendo su atención,<br><br> <b>SINCHI</b><br><br> <i>Este es un servicio de notificaciones generado automáticamente por medio de correo electrónico, no lo responda.</i> <br>",r="Se Actualizaron/Crearon Integrantes para el Proyecto con # de Convenio "+d.convenioproyecto+", Nombre: "+d.nombreproyecto;d.envioNotificaciones(r,"Actualización/Creación de Integrantes del Proyecto",t)}else d.showMessage(!0,3e3,"error",o.message);d.loading=!1})).catch((function(o){d.showMessage(!0,3e3,"error",o),d.loading=!1}))},saveitemCompromiso:function(){var o=this.compromisos.length,e=[];this.loading=!0;for(var t=0;t<o;t++){var r="",i=this.compromisos[t].descripcion;if(r=this.compromisos[t].personal,""!=i&&void 0!=i)if(e.length>0){for(var a=0;a<e.length;a++)if(i==e[a].descripcion){var n=t+1;return this.showMessage(!0,3e3,"error","La Descripción "+i+" del item "+n+" ya se encuentra en el item "+e[a].codigo),void(this.loading=!1)}e.push({codigo:t+1,personal:r,descripcion:i,proyecto:this.proyecto})}else e.push({codigo:t+1,personal:r,descripcion:i,proyecto:this.proyecto})}var c=this;d.guardarData(e).then((function(o){if(o.response){var t=o.response.data.message;c.showMessage(!0,3e3,"error",t)}else if(o.statusText){c.showMessage(!0,3e3,"success","Se Actualizarón/Agregarón los Compromisos de un Integrante del Proyecto con éxito"),c.traerCompromisos(c.proyecto,e[0].personal),c.agregaBitacora("ACTUALIZACION/CREACION","SE ACTUALIZARON/AGREGARON COMPROMISOS PARA EL INTEGRANTE "+c.nombreintegrante+"DEL PROYECTO CON # DE CONVENIO: "+c.convenioproyecto+" Y NOMBRE: "+c.nombreproyecto);var r="Cordial Saludo,<br><br> Se Actualizaron/Crearon Compromisos para el Integrante '"+c.nombreintegrante+"' para el Proyecto con # de Convenio "+c.convenioproyecto+", Nombre: "+c.nombreproyecto+"<br><br>Agradeciendo su atención,<br><br> <b>SINCHI</b><br><br> <i>Este es un servicio de notificaciones generado automáticamente por medio de correo electrónico, no lo responda.</i> <br>",i="Se Actualizaron/Crearon Compromisos para el Integrante '"+c.nombreintegrante+"' para el Proyecto con # de Convenio '"+c.convenioproyecto+"', Nombre: '"+c.nombreproyecto+"'";c.envioNotificaciones(i,"Actualización/Creación de Compromisos de Integrantes del Proyecto",r)}else c.showMessage(!0,3e3,"error",o.message);c.loading=!1})).catch((function(o){c.showMessage(!0,3e3,"error",o),c.loading=!1}))},agregaBitacora:function(o,e){var t={modulo:"EQUIPO PROYECTOS",accion:o,detalle:e};this.$root.$emit("agregaBitacora",t)}},watch:{proyecto:function(o){0!=o&&this.traerequipo(o)}},mounted:function(){this.traerequipo(this.proyecto),this.traePersonal(),this.traerRoles()}},h=g,v=t("2877"),f=Object(v["a"])(h,r,i,!1,null,null,null);e["default"]=f.exports}}]);
//# sourceMappingURL=chunk-2d22d808.a1b7d425.js.map